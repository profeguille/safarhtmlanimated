<!DOCTYPE html>
<html>
  <body>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      html,
      body {
        width: 100%;
        height: 100%;
      }

      canvas {
        display: block;
        border: 1px solid #d3d3d3;
        position: fixed;
        top: 0;
        left: 0;
        z-index: -1;
      }

      .full {
        width: 100vw;
        height: 100vh;

        font-size: 80px;
        /* display: flex;
        flex-direction: column; 
        justify-content: center; 
        align-items: center; */
        display: grid;
        grid-template-rows: 1fr 0fr 1fr;
      }
      .cvh {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: margin 700ms;
      }
      .mm50 {
        margin-top: -50px;
      }
      .mp50 {
        margin-top: 50px;
      }
    </style>

    <canvas id="myCanvas">
      Your browser does not support the HTML5 canvas tag.
    </canvas>
    <div class="container">
      <div id="0" class="full">
        <div></div>
        <div class="cvh">Time with God</div>
        <div></div>
      </div>
      <div id="1" class="full">
        <div></div>
        <div class="cvh">Child of God</div>
        <div></div>
      </div>
      <div id="2" class="full">
        <div></div>
        <div class="cvh">God the Father</div>
        <div></div>
      </div>
      <div id="3" class="full">
        <div></div>
        <div class="cvh">Jesus</div>
        <div></div>
      </div>
      <div id="4" class="full">
        <div></div>
        <div class="cvh">The Cross</div>
        <div></div>
      </div>
      <div id="5" class="full">
        <div></div>
        <div class="cvh">Following Jesus</div>
        <div></div>
      </div>
      <div id="6" class="full">
        <div></div>
        <div class="cvh">The Holly Spirit</div>
        <div></div>
      </div>
      <div id="7" class="full">
        <div></div>
        <div class="cvh">It's Good News</div>
        <div></div>
      </div>
      <div id="8" class="full">
        <div></div>
        <div class="cvh">Prayer</div>
        <div></div>
      </div>
      <div id="9" class="full">
        <div></div>
        <div class="cvh">The Church</div>
        <div></div>
      </div>
      <div id="10" class="full">
        <div></div>
        <div class="cvh">Time with God</div>
        <div></div>
      </div>
      <div id="11" class="full">
        <div></div>
        <div class="cvh">Child of God</div>
        <div></div>
      </div>
      <div id="12" class="full">
        <div></div>
        <div class="cvh">God the Father</div>
        <div></div>
      </div>
      <div id="13" class="full">
        <div></div>
        <div class="cvh">Jesus</div>
        <div></div>
      </div>
      <div id="14" class="full">
        <div></div>
        <div class="cvh">The Cross</div>
        <div></div>
      </div>
      <div id="15" class="full">
        <div></div>
        <div class="cvh">Following Jesus</div>
        <div></div>
      </div>
      <div id="16" class="full">
        <div></div>
        <div class="cvh">The Holly Spirit</div>
        <div></div>
      </div>
      <div id="17" class="full">
        <div></div>
        <div class="cvh">It's Good News</div>
        <div></div>
      </div>
      <div id="18" class="full">
        <div></div>
        <div class="cvh">Prayer</div>
        <div></div>
      </div>
      <div id="19" class="full">
        <div></div>
        <div class="cvh">The Church</div>
        <div></div>
      </div>
      <div id="20" class="full">
        <div></div>
        <div class="cvh">Time with God</div>
        <div></div>
      </div>
      <div id="21" class="full">
        <div></div>
        <div class="cvh">Child of God</div>
        <div></div>
      </div>
      <div id="22" class="full">
        <div></div>
        <div class="cvh">God the Father</div>
        <div></div>
      </div>
      <div id="23" class="full">
        <div></div>
        <div class="cvh">Jesus</div>
        <div></div>
      </div>
      <div id="24" class="full">
        <div></div>
        <div class="cvh">The Cross</div>
        <div></div>
      </div>
      <div id="25" class="full">
        <div></div>
        <div class="cvh">Following Jesus</div>
        <div></div>
      </div>
      <div id="26" class="full">
        <div></div>
        <div class="cvh">The Holly Spirit</div>
        <div></div>
      </div>
      <div id="27" class="full">
        <div></div>
        <div class="cvh">It's Good News</div>
        <div></div>
      </div>
      <div id="28" class="full">
        <div></div>
        <div class="cvh">Prayer</div>
        <div></div>
      </div>
      <div id="29" class="full">
        <div></div>
        <div class="cvh">The Church</div>
        <div></div>
      </div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>

    <script>
      function isScrolledIntoView(el) {
        var rect = el.getBoundingClientRect();
        var elemTop = rect.top;
        var elemBottom = rect.bottom;
        // Only completely visible elements return true:
        //var isVisible = elemTop >= 0 && elemBottom <= window.innerHeight;
        // Partially visible elements return true:
        var isVisible = elemTop < window.innerHeight && elemBottom >= 0;
        return isVisible;
      }

      var fullDivs = document.getElementsByClassName("full");
      let active = 0;
      function checkInView() {
        for (let i = 0; i < fullDivs.length; i++) {
          if (isScrolledIntoView(fullDivs[i].children[1])) {
            active = i;
            changeColor();
            window.scroll({
              top: fullDivs[i].children[0].offsetTop,
              left: 0,
              behavior: "smooth",
            });
            break;
          }
        }
      }

      var _scrollTimeout = null;
      window.addEventListener(
        "wheel",
        function (event) {
          clearTimeout(_scrollTimeout);
          _scrollTimeout = setTimeout(function () {
            let goingUp;
            //going up
            if (event.deltaY < 0) {
              active -= 1;
              goingUp = true;
              if (active < 0) active = 0;
            } else if (event.deltaY > 0) {
              active += 1;
              goingUp = false;
              if (active > 29) active = 29;
            }

            let text = document.getElementById(active + "").children[1];
            text.classList.remove("mp50");
            text.classList.remove("mm50");
            $([document.documentElement, document.body]).animate(
              {
                scrollTop: document.getElementById(active + "").children[0]
                  .offsetTop,
              },
              {
                duration: 200,
                complete: function () {
                  text.classList.add(goingUp ? "mp50" : "mm50");
                },
              }
            );
          }, 50);
          event.preventDefault();
        },
        { passive: false }
      );

      const diffe = (a, b) => (a > b ? a - b : b - a);
      function waitForScrollEnd() {
        let last_changed_frame = 0;
        let last_x = window.scrollX;
        let last_y = window.scrollY;

        return new Promise((resolve) => {
          function tick(frames) {
            // We requestAnimationFrame either for 500 frames or until 20 frames with
            // no change have been observed.
            if (frames >= 500 || frames - last_changed_frame > 20) {
              resolve();
            } else {
              if (window.scrollX != last_x || window.scrollY != last_y) {
                last_changed_frame = frames;
                last_x = window.scrollX;
                last_y = window.scrollY;
              }
              requestAnimationFrame(tick.bind(null, frames + 1));
            }
          }
          tick(0);
        });
      }
      document.addEventListener(
        "scroll",
        (e) => {
          goTo = this.scrollY;

          if (this.oldScroll > this.scrollY) {
            pomY = +1;
          } else {
            pomY = -1;
          }
          //checkInView();

          waitForScrollEnd().then(() => {
            checkInView();
            if (goTo > currentY) {
              pomY = +1;
            } else if (goTo < currentY) {
              pomY = -1;
            }
          });
          this.oldScroll = this.scrollY;
        },
        { passive: false }
      );
      window.addEventListener("load", () => {
        checkInView();
      });

      var c = document.getElementById("myCanvas");
      var ctx = c.getContext("2d");
      c.width = window.innerWidth;
      c.height = window.innerHeight;
      //c.height = 30000;
      var w = window.innerWidth * 0.9;
      const colorArray = [
        { l: "#fa446b", d: "#d54766" },
        { l: "#a965f9", d: "#8754c5" },
        { l: "#c5f22f", d: "#acd035" },
        { l: "#fa8757", d: "#ed6d3d" },
        { l: "#f0d33a", d: "#e6c815" },
        { l: "#54b6d7", d: "#5697ac" },
        { l: "#359cf0", d: "#438fce" },
        { l: "#dd1aeb", d: "#b916c6" },
        { l: "#3fc480", d: "#3bad73" },
        { l: "#f05657", d: "#d54f50" },
      ];

      let colorI = 0;

      let lCurrentColor = colorArray[0].l;
      let dCurrentColor = colorArray[0].d;

      let lToColor = colorArray[0].l;
      let dToColor = colorArray[0].d;

      let blend = 0;

      function changeColor() {
        let auxActive = active || 0;
        if (auxActive > 9) auxActive -= 10;
        if (auxActive > 9) auxActive -= 10;
        if (auxActive > 9) auxActive -= 10;
        if (auxActive > 9) auxActive -= 10;

        lToColor = colorArray[auxActive].l;
        dToColor = colorArray[auxActive].d;

        blend = 0;
      }

      function blendColors(colorA, colorB, amount) {
        const [rA, gA, bA] = colorA.match(/\w\w/g).map((c) => parseInt(c, 16));
        const [rB, gB, bB] = colorB.match(/\w\w/g).map((c) => parseInt(c, 16));
        const r = Math.round(rA + (rB - rA) * amount)
          .toString(16)
          .padStart(2, "0");
        const g = Math.round(gA + (gB - gA) * amount)
          .toString(16)
          .padStart(2, "0");
        const b = Math.round(bA + (bB - bA) * amount)
          .toString(16)
          .padStart(2, "0");
        return "#" + r + g + b;
      }

      var cant = 0;
      var y = 0;
      var plusOrMinus = Math.random() < 0.1 ? -1 : 1;
      var opo = plusOrMinus == 1 ? -1 : 1;

      var plusColor = true;
      //let fastY = false;
      let goTo = 0;
      let currentY = 0;
      function drawSquare(square, color) {
        let { a, b, c, d } = square;
        ctx.beginPath();
        ctx.moveTo(a.x, a.y - currentY);
        ctx.lineTo(b.x, b.y - currentY);
        ctx.lineTo(c.x, c.y - currentY);
        ctx.lineTo(d.x, d.y - currentY);
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill();
      }
      let pomX = -1;
      let cantX = 50;
      let pomY = 1;
      let cantY = 0;
      let ax = Math.random() / 10 + 0.2;
      let ay = Math.random() / 10 + 0.3;

      function draw() {
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        if (blend <= 0.52) {
          blend += 0.025;
          lCurrentColor = blendColors(lCurrentColor, lToColor, blend);
          dCurrentColor = blendColors(dCurrentColor, dToColor, blend);
        }

        if ((pomX == -1 && cantX <= 0) || (pomX == 1 && cantX >= 50)) {
          pomX = pomX == -1 ? 1 : -1;
          ax = Math.random() / 10 + 0.1;
          ay = Math.random() / 10 + 0.15;
        }
        cantX = cantX + pomX * ax;

        if ((pomY == -1 && cantY <= 0) || (pomY == 1 && cantY >= 200)) {
          pomY = pomY == -1 ? 1 : -1;
          ax = Math.random() / 10 + 0.1;
          ay = Math.random() / 10 + 0.15;
        }

        cantY = cantY + pomY * ay;

        function drawRowDark(rowY) {
          drawSquare(
            {
              a: { x: 20 + cantX, y: -180 + cantY + rowY },
              b: { x: 100 + cantX, y: -380 + cantY + rowY },
              c: { x: w + 20 - cantX, y: 100 + cantY + rowY },
              d: { x: w + 100 - cantX, y: 300 + cantY + rowY },
            },
            dCurrentColor
          );

          drawSquare(
            {
              a: { x: w * 0.2 + 20 + cantX, y: 520 + cantY + rowY },
              b: { x: w * 0.2 + 100 + cantX, y: 320 + cantY + rowY },
              c: { x: w + 120 - cantX, y: 1100 + cantY + rowY },
              d: { x: w + 100 - cantX, y: 1300 + cantY + rowY },
            },
            dCurrentColor
          );

          drawSquare(
            {
              a: { x: w * 0.35 + 20 + cantX, y: 1520 + cantY + rowY },
              b: { x: w * 0.4 + 100 + cantX, y: 1320 + cantY + rowY },
              c: { x: w * 0.42 + 20 + cantX, y: 2000 + cantY + rowY },
              d: {
                x: w * 0.47 + 20 + cantX - 200,
                y: 1800 + cantY + rowY,
              },
            },
            dCurrentColor
          );

          drawSquare(
            {
              c: { x: w + cantX + 5, y: 2350 + cantY + rowY },
              d: { x: w * 0.9 + cantX, y: 2500 + cantY + rowY },
              a: { x: w * 0.87 + 20 + cantX, y: 2020 + cantY + rowY },
              b: { x: w * 0.9 + 100 + cantX, y: 2220 + cantY + rowY },
            },
            dCurrentColor
          );
        }

        function drawRowLight(rowY) {
          drawSquare(
            {
              c: { x: w + 20 - cantX, y: 100 + cantY + rowY },
              d: { x: w + 100 - cantX, y: 300 + cantY + rowY },
              a: { x: w * 0.2 + 20 + cantX, y: 520 + cantY + rowY },
              b: { x: w * 0.2 + 100 + cantX, y: 320 + cantY + rowY },
            },
            lCurrentColor
          );
          drawSquare(
            {
              c: { x: w + 120 - cantX, y: 1100 + cantY + rowY },
              d: { x: w + 100 - cantX, y: 1300 + cantY + rowY },
              a: { x: w * 0.35 + 20 + cantX, y: 1520 + cantY + rowY },
              b: { x: w * 0.4 + 100 + cantX, y: 1320 + cantY + rowY },
            },
            lCurrentColor
          );

          drawSquare(
            {
              c: { x: w * 0.42 + 20 + cantX, y: 2000 + cantY + rowY },
              d: {
                x: w * 0.47 + 20 + cantX - 200,
                y: 1800 + cantY + rowY,
              },
              a: { x: w * 0.87 + 20 + cantX, y: 2020 + cantY + rowY },
              b: { x: w * 0.9 + 100 + cantX, y: 2220 + cantY + rowY },
            },
            lCurrentColor
          );
          drawSquare(
            {
              c: { x: w + cantX + 5, y: 2350 + cantY + rowY },
              d: { x: w * 0.9 + cantX, y: 2500 + cantY + rowY },
              a: { x: +20 + cantX, y: 2820 + cantY + rowY },
              b: { x: +100 + cantX, y: 2620 + cantY + rowY },
            },
            lCurrentColor
          );
        }
        if (goTo > currentY) {
          currentY = currentY + diffe(goTo, currentY) / 10;
          if (goTo < currentY) {
            currentY = goTo;
          }
        } else if (goTo < currentY) {
          currentY = currentY - diffe(goTo, currentY) / 10;
          if (goTo > currentY) {
            currentY = goTo;
          }
        }
        for (let k = 0; k <= 90000; k = k + 3000) {
          drawRowDark(k);
        }

        for (let k = 0; k <= 90000; k = k + 3000) {
          drawRowLight(k);
        }

        setTimeout(() => {
          draw();
        }, 17);
      }

      draw();

      let square1 = [];
    </script>
  </body>
</html>
